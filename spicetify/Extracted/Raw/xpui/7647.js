"use strict";(("undefined"!=typeof self?self:global).webpackChunkclient_web=("undefined"!=typeof self?self:global).webpackChunkclient_web||[]).push([[7647],{94653:(e,t,i)=>{i.d(t,{x:()=>C});var n=i(30758),r=i(41978),s=i(15231),a=i(41331),c=i(97500),o=i.n(c),l=i(57574);const d="lyrics-lyricsContent-lyric",u="lyrics-lyricsContent-active",y="lyrics-lyricsContent-highlight",v="lyrics-lyricsContent-unsynced",p="lyrics-lyricsContent-isInteractive",m="lyrics-lyricsContent-text",f="Zg6tXwNaAAopLykLK7Cw",h="lyrics-lyricsContent-provider";var L=i(86070);const g=n.memo((function({onObserve:e,text:t,lineNumber:i,activeLineIndex:r,isTimeSynced:s,translationText:a,onClick:c,onActiveLineChange:h,windowIsVisible:g}){const{ref:b,inView:S}=(0,l.Wx)({threshold:0}),k=(0,n.useRef)(!1);(0,n.useEffect)((()=>{k.current||S&&g&&(e(t),k.current=!0)}),[S,e,t,g]);const w=(0,n.useRef)(),x=(0,n.useRef)(!0);(0,n.useEffect)((()=>{h(w,x.current),x.current=!1}),[r,h]);const I=(0,n.useCallback)((e=>{b(e),w.current=e||void 0}),[b]);return(0,L.jsxs)("div",{dir:"auto",className:o()(d,{[p]:!!c,[u]:r===i,[y]:r>i,[v]:!s}),"data-testid":"fullscreen-lyric",ref:I,onClick:c,children:[(0,L.jsx)("div",{className:m,children:t}),a&&(0,L.jsx)("div",{className:f,children:a})]})}));var b=i(74493);const S={start:0,end:1,text:""};var k=i(63583),w=i(20769),x=i(49151);var I=i(24060),T=i(48248);const C=n.memo((function({trackUri:e,data:t,format:i,onLineClick:c,onActiveLineChange:o,isSnippet:l}){const{provider:d,providerLyricsId:u,providerDisplayName:y,syncType:v,isTimeSynced:p}=t,m=(0,r.d4)(I.s),{lyricWithEmptyLines:f,activeLineIndex:C,hasSkipped:E,shouldAnimateScroll:N}=((e,t,i)=>{const r=(0,n.useRef)(0),{lyrics:s=[],isTimeSynced:a,alternatives:c}=t,o=(0,n.useRef)(0),[l]=(0,b.f)(500,(t=>t?.item?.uri===e)),d=i?c?.find((({language:e})=>e.substring(0,2)===i.substring(0,2)))?.lines:null,u=(0,n.useMemo)((()=>[...new Array(2).fill(S),...s].map(((e,t)=>({...e,lineNumber:t,translationText:d?.[t-2]})))),[s,d]),y=a?u.findIndex((({start:e,end:t})=>l>=e&&l<t)):-1,v=o.current;o.current=y;const p=Math.abs(y-v)<=4,m=Math.abs(l-r.current)>2e3;return r.current=l,{lyricWithEmptyLines:u,activeLineIndex:y,prevActiveLineIndex:v,lineIndexDiff:y-v,shouldAnimateScroll:p,hasSkipped:m}})(e,t,m),A=function(e){const{trackUri:t,format:i,provider:r,providerLyricsId:s,syncType:a,isSnippet:c}=e,[o,l]=(0,n.useState)(!1),[d,u]=(0,n.useState)(0),[y,v]=(0,n.useState)(!1),p=(0,x.o)((e=>e?.playbackId??void 0)),m=(0,n.useMemo)((()=>(0,k.W)({lyrics_format:i,track_uri:t,provider:r,provider_lyrics_id:s,sync_type:a,playback_id:p,is_snippet:c})),[i,t,r,s,a,p,c]);(0,n.useEffect)((()=>{l(!1),u(0),v(!1);const e=setTimeout((()=>{v(!0)}),1500);return()=>{clearTimeout(e)}}),[m]);const f=(0,w.vh)();return(0,n.useEffect)((()=>{o||d>=140&&y&&(f.send(m),l(!0))}),[d,o,m,f,y]),(0,n.useCallback)((e=>{e.length>1&&u((t=>t+e.length))}),[u])}({trackUri:e,format:i,provider:d,providerLyricsId:u,syncType:v,isSnippet:l}),R=(0,T.g)();return(0,L.jsxs)(L.Fragment,{children:[f.map((({text:e,lineNumber:t,translationText:i})=>(0,L.jsx)(g,{text:e,translationText:i,lineNumber:t,activeLineIndex:C,isTimeSynced:p,onObserve:A,onClick:c&&(e=>c(e,f[t].start)),onActiveLineChange:(e,i)=>o({lineRef:e,firstUpdate:i,isFirstLine:p&&0===t,isActiveLine:p&&C===t,activeLineIndex:C,hasSkipped:E,shouldAnimateScroll:N}),windowIsVisible:"visible"===R},t))),!l&&y&&(0,L.jsx)("div",{className:h,children:(0,L.jsx)(s.E,{as:"p",variant:"bodySmall",dir:"auto",children:a.Ru.get("web-player.lyrics.providedBy",y)})})]})}))},35411:(e,t,i)=>{i.d(t,{H:()=>r,k:()=>n});const n=18e5,r=6e5},90029:(e,t,i)=>{i.d(t,{I:()=>h});var n=i(2569),r=i(39733),s=i(35411),a=i(10423),c=i(49571),o=i(26528),l=i(35904),d=i(10940),u=i(56629);function y(e,t,i){const{startTimeMs:n,words:r}=e,s=i[t+1];return{start:n||0,end:s&&s.startTimeMs?s.startTimeMs:1/0,text:r}}function v(e){return d.Q.fromInt(e).toCSS(u.a.RGB)}var p=i(52037),m=i(4355);const f={hasLyrics:!1},h=(e,t)=>{const i=(0,p.h)(t||void 0,{desiredLabel:"large",desiredSize:600})??t?.[0]?.url??"",d=(0,c.X)(),u=(0,r.NC)(m.Tc,{loadingValue:m.LZ.CONTROL}),h={[m.LZ.CONTROL]:void 0,[m.LZ.SYSTEM_LANGUAGE]:navigator.language,[m.LZ.ALL_LANGUAGES]:"all"}[u],L=["lyrics",{uri:e,image:i,vocalRemoval:d}],{hasLyrics:g,isLoading:b}=(0,a.f)(e),{data:S,isLoading:k,isError:w}=(0,n.I)({queryKey:L,queryFn:async()=>{if(!e||!i)return f;const t=await async function(e,t,i=!1,n){try{const a=await(0,o.S)(e,t,i,n);return{hasLyrics:!0,isTimeSynced:(s=a.lyrics.syncType,"LINE_SYNCED"===s||"SYLLABLE_SYNCED"===s),syncType:a.lyrics.syncType,lyrics:a.lyrics.lines.map(y),colors:(r=a.colors,{text:v(r.text),activeText:v(r.highlightText),background:v(r.background)}),provider:a.lyrics.provider,providerDisplayName:a.lyrics.providerDisplayName,providerLyricsId:a.lyrics.providerLyricsId,hasVocalRemoval:a.hasVocalRemoval??!1,showUpsell:a.lyrics.showUpsell??!1,alternatives:a.lyrics.alternatives}}catch(e){if(e instanceof l.O&&404===e.status)return{hasLyrics:!1};throw e}var r,s}(e,i,d,h);return t},gcTime:s.k,staleTime:s.H,enabled:g}),x=b||k;let I=null;return x||(I=g?S??null:f),{data:I,loading:x,error:w}}},10423:(e,t,i)=>{i.d(t,{f:()=>d});var n=i(2569),r=i(18230),s=i(39733),a=i(59677),c=i(35411),o=i(26528),l=i(19019);const d=e=>{const t=!!e&&(0,a.U_)(e),i=(0,s.NC)(l.s6w)&&t,{data:d,isLoading:u}=(0,n.I)({queryKey:["useLyricsAvailability",e],queryFn:async()=>!!e&&await(0,o.z)(e),gcTime:c.k,staleTime:c.H,enabled:i,placeholderData:r.rX});return{isLoading:u,hasLyrics:!!i&&(d??!1)}}},70923:(e,t,i)=>{i.d(t,{J:()=>s});var n=i(90029),r=i(49151);const s=()=>{const e=(0,r.o)((e=>e?.item),((e,t)=>e?.uri===t?.uri));return(0,n.I)(e?.uri,e?.images)}},49571:(e,t,i)=>{i.d(t,{X:()=>a});var n=i(39733),r=i(19019),s=i(4279);const a=()=>{const e=(0,s.S)(),{isSupported:t}=e.getCapabilities();return(0,n.NC)(r.OBX,{loadingValue:!1})&&t}},24060:(e,t,i)=>{i.d(t,{s:()=>r,u:()=>n});const n=e=>e.ui.lyrics.mode,r=e=>e.ui.lyrics.translationLanguage},26528:(e,t,i)=>{i.d(t,{S:()=>a,z:()=>c});var n=i(59677),r=i(93409),s=i(76629);const a=async(e,t,i,a)=>{const c=(0,n.o_)(e).id,o=r.n.getInstance(),l={format:"json",vocalRemoval:i};a&&(l.clientLanguage=a);return(await o.build().withHost(s.Hj).withPath(`/track/${encodeURIComponent(c)}/image/${encodeURIComponent(t)}`).withQueryParameters(l).withEndpointIdentifier("/track/{trackId}").send()).body},c=async e=>{const t=(0,n.Y8)((0,n.o_)(e)?.id);if(!t)return!1;const i=r.n.getInstance(),a=await i.build().withHost(s.XE).withPath(`/track/${encodeURIComponent(t)}`).withEndpointIdentifier("/track/{trackId}").send();return a.body?.has_lyrics||!1}},48248:(e,t,i)=>{i.d(t,{g:()=>r});var n=i(30758);function r(){const[e,t]=(0,n.useState)(document.visibilityState);return(0,n.useEffect)((()=>{const e=()=>t(document.visibilityState);return document.addEventListener("visibilitychange",e),()=>document.removeEventListener("visibilitychange",e)}),[]),e}},35369:(e,t,i)=>{i.d(t,{f:()=>c,z:()=>a});var n=i(30758),r=i(13390),s=i(53945);function a(e,t=r.l0o){const i=(0,s.as)();return(0,n.useEffect)((()=>(e&&i((0,s.Mo)(e)),()=>{i((0,s.Hf)())})),[e,i]),e||t}const c=({color:e,fallbackColor:t})=>(a(e,t),null)}}]);
//# sourceMappingURL=7647.js.map