"use strict";(("undefined"!=typeof self?self:global).webpackChunkclient_web=("undefined"!=typeof self?self:global).webpackChunkclient_web||[]).push([[6548],{28934:(e,s,a)=>{a.r(s),a.d(s,{default:()=>Ds});var i=a(30758),t=a(83169),n=a(89453),r=a(41331),l=a(61611),c=a(27046),d=a(69524),o=a(15231),u=a(74946),m=a(55204),f=a(78158),x=a(95404),h=a(46132);let j=function(e){return e[e.LOADING=0]="LOADING",e[e.CONNECTED=1]="CONNECTED",e[e.DISCONNECTED=2]="DISCONNECTED",e}({});var g=a(11892),b=a(25244),N=a(86595),p=a(2569);var y=a(97500),v=a.n(y),k=a(74554),S=a(5290),C=a(45292),R=a(14442),I=a(53452),E=a(57316);const w="cey3hc5X4ymwEYmedF9F",L="Le2ZXlfi8l8hZhCYbmSj",D="he3Rpn7Wz3NaftrVjAuH",A="_BQFK3tB0bgzqFCn7Cj7";var T=a(86070);const P=({name:e,following:s,imageUrl:a,uri:n})=>{const c=(0,I.f)(),d=(0,C.W)(),u=i.createRef(),[m,f]=(0,i.useState)(s);(0,E.N)(R.mc.OPERATION_COMPLETE,(e=>{if(e.data.uris.includes(n))switch(e.data.operation){case R.JK.FOLLOW_USER:f(!0);break;case R.JK.UNFOLLOW_USER:f(!1)}}));const x=(0,i.useCallback)((()=>{m?c.unfollowUsers([n]):(c.followUsers([n]),d({intent:"follow",type:"click",itemIdSuffix:"buddyfeed"})),u.current&&u.current.blur()}),[m,u,n,c,d]);return(0,i.useEffect)((()=>{f(s)}),[s]),(0,T.jsxs)("div",{className:w,children:[(0,T.jsx)(S.e,{label:e,width:40,userIconSize:"small",images:(0,i.useMemo)((()=>[{width:40,height:40,url:a}]),[a])}),(0,T.jsxs)("div",{className:v()(L,"ellipsis-one-line"),children:[(0,T.jsx)(o.E,{as:"p",variant:"bodySmallBold",className:"ellipsis-one-line",children:e}),m&&(0,T.jsx)(o.E,{as:"p",variant:"marginal",className:"ellipsis-one-line",children:r.Ru.get("following")})]}),(0,T.jsx)("div",{className:D,children:(0,T.jsx)(l.a,{className:A,size:"sm",ref:u,onClick:x,ariaLabel:m?r.Ru.get("buddy-feed.button.remove-friend"):r.Ru.get("buddy-feed.button.add-friend"),icon:m?k.M:t.k})})]})},F="SjPnh6wzlE2D_Eyb_I_i";function _({facebookFriends:e}){return(0,T.jsx)("div",{className:F,children:e.map((({uri:e,following:s,title:a,image:i})=>(0,T.jsx)(P,{uri:e,name:a,imageUrl:i,following:s},`fb-friend-${e}`)))})}const O="yVXmLK1K6pmtPe83gnoi";function U(){return(0,T.jsx)("div",{className:O,children:Array(20).fill(0).map(((e,s)=>(0,T.jsx)(N.Y,{isLoading:!0,charCount:100,as:"p",variant:"titleSmall"},s)))})}const B="DRM5jiRwP8kjAwzu7xk5",W="qr7QRUyXsuUlO7axj_Pt",z="bNRhpD95SGcRlVhndWcn",Z="cIJ13_Op585JAdVuiSpb",H="Fs5DCVhNZkMzGbRFcd4L",Q="mZPcBBkAHhnim1L5HTVm",V="Jvah5KRPqyI7irpNmlaN",G="B4r4LurFaN4u62WbJHEw",M="AbxEqQpHNQVjia6oDIzy",J=({onBackButtonClick:e})=>{const[s,a]=(0,i.useState)(""),{isLoading:t,friends:n}=(e=>{const s=(0,h.C)(),a=e.trim().toLowerCase(),{data:i,isLoading:t}=(0,p.I)({queryKey:["useFacebookFriends"],queryFn:async()=>(await s.fetchFacebookFriends()).sort(((e,s)=>e.title>s.title?1:-1))});return{isLoading:t,friends:i?.filter((({title:e})=>-1!==e.trim().toLowerCase().indexOf(a)))??[]}})(s),c=(0,g.YQ)((e=>{a(e.target.value)}),100),u=(0,i.useCallback)((e=>{null!==e&&e.focus()}),[]);return(0,T.jsxs)("div",{className:B,children:[(0,T.jsx)(l.a,{ariaLabel:r.Ru.get("buddy-feed.button.back"),onClick:e,ref:u,className:W,icon:d.g,size:"sm",testId:"back-to-friends"}),(0,T.jsxs)("div",{className:z,children:[(0,T.jsx)("div",{className:Z,children:(0,T.jsx)(m.G,{className:H,size:"large"})}),(0,T.jsx)("div",{className:Q,children:t?(0,T.jsx)(N.Y,{isLoading:!0,charCount:25,as:"p",variant:"bodySmall"}):(0,T.jsx)(o.E,{as:"p",variant:"bodySmall",children:r.Ru.get("buddy-feed.number-of-friends",n.length)})})]}),t?(0,T.jsx)(U,{}):(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)("div",{className:V,children:[(0,T.jsx)(b.C,{className:M,size:"small",role:"presentation"}),(0,T.jsx)("input",{onChange:c,className:G,placeholder:r.Ru.get("buddy-feed.find-in-playlists")})]}),(0,T.jsx)(_,{facebookFriends:n})]})]})};var Y=a(95926);function q({isOpen:e,onClose:s,onConfirm:a}){return(0,T.jsx)(Y.T,{onClose:s,"aria-label":r.Ru.get("web-player.buddy-feed.connect-with-facebook-title"),onConfirm:a,titleText:r.Ru.get("web-player.buddy-feed.connect-with-facebook-title"),descriptionText:r.Ru.get("web-player.buddy-feed.connect-with-facebook-description"),cancelText:r.Ru.get("queue.cancel-button"),confirmText:r.Ru.get("web-player.buddy-feed.connect-button"),isOpen:e})}const K="lPDqjZWZMsdD4yc00T2X",X="JfNeNZziDnktIRb29RLV",$="VR5PLGPz9AM_CbDWgf34",ee="w_89IGjukyLkRHojI80u",se="e5WAdruoZ3DjOzKDItZH",ae="BlAb_EfGNQXaz00GASPZ",ie="umsKuFPqgF42Qhs2m0Ud",te="_zPMjS082V1vqTdHTyeb",ne="xXJ4W5P2DG0gs1qsg4SL",re="wUlAvP_tJLv1l46W8DlA",le=e=>{const s=(0,C.W)(),{onBackButtonClick:a,feedIsEmpty:t,goToAddFriends:n=!1}=e,c=function(){const e=(0,h.C)(),[s,a]=(0,i.useState)(j.LOADING);return(0,i.useEffect)((()=>e.subscribeToFacebookConnectionState((e=>{a(e.connection?j.CONNECTED:j.DISCONNECTED)})).cancel),[e]),s}(),g=(0,h.C)(),[b,N]=(0,i.useState)(!1),[p,y]=(0,i.useState)(!1),[v,k]=(0,i.useState)(!1),S=(0,i.useCallback)((e=>{null!==e&&e.focus()}),[]),R=(0,i.useCallback)((()=>{location.reload()}),[]);if(p)return(0,T.jsxs)("div",{className:ne,children:[(0,T.jsx)(l.a,{onClick:a,ref:S,className:$,ariaLabel:r.Ru.get("buddy-feed.button.back"),icon:d.g,size:"sm"}),(0,T.jsxs)("div",{className:re,children:[(0,T.jsx)(o.E,{as:"h1",variant:"bodyMediumBold",className:X,children:r.Ru.get("error-dialog.generic.header")}),(0,T.jsx)(o.E,{as:"p",variant:"bodySmall",className:ee,children:r.Ru.get("error-dialog.generic.body")}),(0,T.jsx)(u.$,{colorSet:"invertedLight",onClick:R,children:r.Ru.get("error.reload")})]})]});const I=(n||v)&&c===j.CONNECTED;return(0,T.jsxs)("div",{className:K,children:[I&&(0,T.jsx)(J,{onBackButtonClick:()=>{t&&k(!1),a()}}),!I&&(0,T.jsxs)("div",{className:ae,children:[(0,T.jsx)(l.a,{ariaLabel:r.Ru.get("buddy-feed.button.back"),onClick:a,className:$,ref:S,icon:d.g,size:"sm"}),(0,T.jsx)(o.E,{as:"h1",variant:"bodyMediumBold",className:X,children:r.Ru.get("buddy-feed.friend-activity")}),(0,T.jsx)(o.E,{as:"p",variant:"bodySmall",className:ee,children:r.Ru.get("buddy-feed.facebook.connect-with-friends-default")}),(0,T.jsx)("div",{className:ie,children:(0,T.jsx)(u.$,{className:te,size:"small",iconLeading:m.G,UNSAFE_colorSet:(0,f.mA)("#2374E1",x.ONy),onClick:()=>{s({intent:"connect-to-facebook",type:"click",itemIdSuffix:"buddyfeed"}),c!==j.CONNECTED?N(!0):k(!0)},children:r.Ru.get("buddy-feed.facebook.button")})}),(0,T.jsx)(o.E,{as:"p",variant:"marginal",className:se,children:r.Ru.get("buddy-feed.facebook.disclaimer")}),(0,T.jsx)(q,{isOpen:b,onClose:()=>{N(!1)},onConfirm:()=>{g.connectToFacebook().then((()=>{k(!0),N(!1)})).catch((()=>{y(!0)}))}})]})]})};var ce=a(58923),de=a(75977);const oe="CvWRWfWfmS9_2fgM7c3A",ue="gtJcoAXGeGQ9ochIvg6h",me="diF001PSbmYyyekikwD9",fe="sGj6VHKqd2s4IorAqiYI",xe="R_Dc8rJShBX3HCHsoSsq",he="dAPXjNmPLJI6x_sXJwAp",je="cRB7yMdTUrWxDud8Uqvi",ge="RTHphmJ9fFJyJWFe9Kwt",be="cm9IUdJYVsbGCooedALf",Ne="SN5MVM1k5tAxwKeA7WDr",pe="Bpdhrb_he3jzWLv40DpE",ye="rV7v8LWgSCAQH6wodc1N",ve="fD6FfGUH4oiEHvaEXITg",ke="egK4lu76sYvMmma40Vng",Se="RItf9PObrjsfieRog2Jj",Ce="j1tGXZDi8vflz1A_NWQU",Re="EpVUADOpqlfkLFcs9tW4",Ie="kp0akgKlDKFzAq4rimAA",Ee="Qv8skgTQdi726aBDU7h1",we="oiz3mGNiTftvX5tHHGdT",Le="jaX1TSMeWI3kuiSaau2B",De="dk6yb9gfDFu9V6rM1BdS",Ae="mABzBE2Irar9vYpZdr9u",Te="Ipv3_ecgOssTDK4Z4uYg",Pe="TkNHSTmRSrRuhd5EpRQg",Fe="ZV8pEC8PUrYmlL0YmteP",_e="V9CrlOWUnPzlcVRfUjy7",Oe="Pvf7VacWGW22R2cyG3RZ",Ue=({showOnlineIndicator:e})=>(0,T.jsxs)("div",{className:Le,children:[(0,T.jsxs)("div",{className:De,children:[(0,T.jsx)(de.v,{size:"medium"}),e?(0,T.jsx)("div",{className:Ae}):null]}),(0,T.jsxs)("div",{className:Te,children:[(0,T.jsx)("div",{className:v()(Pe,Fe)}),(0,T.jsx)("div",{className:Pe}),(0,T.jsx)("div",{className:Pe})]})]}),Be=()=>(0,T.jsxs)("div",{"data-testid":"buddy-feed-empty-state",className:Ee,children:[(0,T.jsx)(o.E,{as:"p",className:we,children:r.Ru.get("buddy-feed.let-followers-see-your-listening")}),(0,T.jsx)(Ue,{showOnlineIndicator:!0}),(0,T.jsx)(Ue,{showOnlineIndicator:!0}),(0,T.jsx)(Ue,{}),(0,T.jsx)(o.E,{as:"p",className:we,children:r.Ru.get("buddy-feed.enable-share-listening-activity")}),(0,T.jsx)(ce.N_,{to:"/preferences",className:_e,children:(0,T.jsx)(u.$,{colorSet:"invertedLight",className:Oe,children:r.Ru.get("desktop.settings.settings")})})]});var We=a(68832),ze=a(59677),Ze=a(93720),He=a(99870),Qe=a(75668),Ve=a(21813),Ge=a(33e3),Me=a(36450),Je=a(23100),Ye=a(91360),qe=a(70462),Ke=a(35494),Xe=a(67611);const $e=e=>{const{timestamp:s,isNowPlaying:a}=e;return a?(0,T.jsx)(c.Zp,{label:r.Ru.get("time.now"),children:(0,T.jsx)(Ke.A,{"aria-label":r.Ru.get("time.now"),size:"small"})}):(0,T.jsx)("span",{children:(0,Xe.Z)(s)})};var es=a(68031),ss=a(53222),as=a(78330),is=a(98882),ts=a(4139),ns=a(86317);const rs=e=>Date.now()-e<9e5,ls=(e,s)=>{const a=(0,ze.o_)(e)?.type;switch(a){case ze.NQ.PLAYLIST:case ze.NQ.PLAYLIST_V2:return(0,T.jsx)(Ve.W,{uri:e});case ze.NQ.EPISODE:case ze.NQ.SHOW:return(0,T.jsx)(Ge.H,{uri:e});case ze.NQ.ALBUM:return(0,T.jsx)(He.h,{uri:e,artistUri:s});case ze.NQ.ARTIST:return(0,T.jsx)(Qe.t,{uri:e});default:return null}},cs=e=>{switch(e){case ze.NQ.ALBUM:return ns.c.ALBUM;case ze.NQ.ARTIST:return ns.c.ARTIST;case ze.NQ.SHOW:return ns.c.SHOW;case ze.NQ.EPISODE:return ns.c.EPISODE;case ze.NQ.PLAYLIST:case ze.NQ.PLAYLIST_V2:return ns.c.PLAYLIST;default:return}},ds=e=>{const{show:s=!0,spec:a,friend:t}=e,n=(0,i.useMemo)((()=>t.user.imageUrl?[{url:t.user.imageUrl,width:0,height:0}]:[]),[t.user.imageUrl]),l=(0,C.W)(),c=(0,ts.s)(),d=t.track,u=d.uri,{togglePlay:m,isPlaying:f,isActive:x}=(0,is.P)({uri:u},{featureIdentifier:"buddy_feed",referrerIdentifier:"buddy_feed"}),h=(0,ze.o_)(d.context?.uri),j=h?.type,g=(0,i.useCallback)((()=>{m(),l({intent:f?"pause":"play",type:"click",itemIdSuffix:"buddyfeed_play",targetUri:u});const e=a.friendRowFactory().playButtonFactory();x?f?c.logInteraction(e.hitPause({itemToBePaused:u})):c.logInteraction(e.hitResume({itemToBeResumed:u})):c.logInteraction(e.hitPlay({itemToBePlayed:u}))}),[l,f,u,a,x,m,c]),b=(0,i.useCallback)(((e,s)=>{c.logInteraction(a.friendRowFactory().friendRowLinkFactory({identifier:e}).hitUiNavigate({destination:s}))}),[c,a]),{draggable:N,onDragStart:p}=(0,es.P)({itemUris:[u],dragLabelText:d.name}),{draggable:y,onDragStart:k}=(0,es.P)({itemUris:[d.artist?.uri],dragLabelText:d.artist?.name}),{draggable:R,onDragStart:I}=(0,es.P)({itemUris:[d.context?.uri],dragLabelText:d.context?.name});return s?(0,T.jsxs)("div",{className:v()(oe),children:[(0,T.jsx)(Ze.h,{menu:ls(d.context?.uri,d.artist?.uri),children:(0,T.jsxs)("div",{className:he,children:[(0,T.jsx)(S.e,{label:t.user.name,width:40,userIconSize:"small",images:n,withBadge:rs(t.timestamp)}),(0,T.jsx)(qe.x,{className:je,iconClassName:ge,isPlaying:f,isLocked:!1,onClick:g,playAriaLabel:f?r.Ru.get("pause"):`${r.Ru.get("play")} ${d.artist.name} ${d.name}`})]})}),(0,T.jsxs)("div",{className:v()(be),children:[(0,T.jsxs)("div",{className:Ne,children:[(0,T.jsx)(o.E,{as:"p",variant:"bodySmallBold",className:v()(pe,"ellipsis-one-line"),children:(0,T.jsx)(as.pZ,{value:"/buddyfeed_user_profile",children:(0,T.jsx)(Ze.h,{menu:(0,T.jsx)(Je.B,{uri:t.user.uri}),children:(0,T.jsx)(Ye.N,{title:t.user.name,to:t.user.uri,dir:"auto",onClick:()=>b("profile_link",t.user.uri),children:t.user.name})})})}),(0,T.jsx)(o.E,{as:"p",variant:"marginal",className:v()(ye),children:(0,T.jsx)($e,{timestamp:t.timestamp,isNowPlaying:rs(t.timestamp)})})]}),(0,T.jsxs)(o.E,{as:"p",variant:"marginal",className:ve,children:[(0,T.jsx)(as.pZ,{value:"/buddyfeed_track",children:(0,T.jsx)(Ze.h,{menu:(0,T.jsx)(Me.P,{uri:d.uri,contextUri:d.context?.uri,albumUri:d.album?.uri,artists:[d.artist]}),children:(0,T.jsx)(Ye.N,{title:d.name,to:u,className:"ellipsis-one-line",dir:"auto",draggable:N,onDragStart:p,onClick:()=>b("track_link",u),children:d.name})})}),(0,T.jsx)("span",{"aria-hidden":!0,children:" • "}),(0,T.jsx)(as.pZ,{value:"/buddyfeed_artist",children:(0,T.jsx)(Ze.h,{menu:d.artist?(0,T.jsx)(Qe.t,{uri:d.artist.uri}):null,children:(0,T.jsx)(Ye.N,{title:d.artist?.name,to:d.artist?.uri,className:"ellipsis-one-line",dir:"auto",draggable:y,onDragStart:k,onClick:()=>b("artist_link",d.artist?.uri),children:d.artist?.name})})})]}),(0,T.jsx)(o.E,{as:"p",variant:"marginal",className:v()("ellipsis-one-line",Se),children:(0,T.jsx)(as.pZ,{value:"/buddyfeed_context",children:(0,T.jsx)(Ze.h,{menu:ls(d.context?.uri,d.artist?.uri),children:(0,T.jsxs)(Ye.N,{title:d.context?.name,to:d.context?.uri,className:Ce,draggable:R,onDragStart:I,onClick:()=>b("context_link",d.context?.uri),children:[(0,T.jsx)(ss.s,{type:cs(j),iconSize:16,className:ke}),(0,T.jsx)("span",{dir:"auto",className:"ellipsis-one-line",children:d.context?.name})]})})})})]})]},t.user.uri):null};var os=a(81083),us=a(23330),ms=a(80451);function fs({friends:e,spec:s}){const{currentSession:a}=(0,ms.D)(),t=(0,us.y)(),[n,r]=(0,i.useState)(!0),l=!a?.active&&t&&n&&(0,T.jsx)("li",{className:me,children:(0,T.jsx)(os.p,{localStorageKey:"dismissStartJamButtonFromFriendFeed",onDismiss:()=>r(!1)})},"start-jam-button");return(0,T.jsx)(We.ZI,{flipKey:e.map((e=>e.user.uri)).join(""),children:(0,T.jsxs)("ul",{className:ue,children:[l,e.map(((e,a)=>(0,T.jsx)(We.lf,{flipId:e.user.uri,children:(0,T.jsx)("li",{children:(0,T.jsx)(ds,{friend:e,show:a<100,spec:s},e.user.uri)})},e.user.uri)))]})})}var xs=a(95079),hs=a(94079);const js="b2SEzDk24rotrI10MXdF",gs="t9jTliz65IhcE00IWhWF",bs="VYPnf8PE3BUJvsXFokI9",Ns="toZ5fapUYOIoayR_Mu5w",ps="jtqYCE1JHjVWZ87OQJkp",ys="SmHefvOhwPsxdubIeuIn",vs="wdp_F8H2mSm1ZxhlOU3I",ks="GC_jaLrna3IwrFCrPAET",Ss=({children:e,page:s,nodeRef:a})=>{const i=0===s,t=e.filter(((e,a)=>a!==s));return(0,T.jsx)(xs.A,{component:null,children:t.map((e=>(0,T.jsx)(hs.A,{in:i,timeout:500,nodeRef:a,classNames:{enter:i?js:ps,enterActive:i?gs:ys,exit:i?bs:vs,exitActive:i?Ns:ks},children:e},i?"first-page":"second-page")))})};var Cs=a(75808),Rs=a(70249),Is=a(58111),Es=a(22594),ws=a(70329),Ls=a(78487);const Ds=({friends:e})=>{const s=(0,C.W)(),a=(0,ts.s)(),{spec:d}=(0,Ls.r)(n.W,{}),o=(0,i.useRef)(null),u=(0,i.useRef)(null);(0,i.useEffect)((()=>{s({intent:"view",type:"impression",itemIdSuffix:"buddyfeed"})}),[s]),(0,i.useEffect)((()=>{a.logImpression(d.impression())}),[a,d]);const[m,f]=(0,i.useState)(!1),x=()=>{m||a.logInteraction(d.addFriendButtonFactory().hitUiReveal()),f(!m)},h=0===e.length,j=(0,i.useCallback)((()=>{a.logInteraction(d.closeButtonFactory().hitUiHide())}),[a,d]);return(0,T.jsx)(ws.ql.Provider,{value:"buddy_feed",children:(0,T.jsx)(Cs._,{label:r.Ru.get("buddy-feed.friend-activity"),focusTransferId:"BUDDY-FEED",children:(0,T.jsxs)(Ss,{page:m?1:0,nodeRef:m?u:o,children:[(0,T.jsx)("div",{className:fe,ref:u,children:(0,T.jsx)(le,{onBackButtonClick:x,feedIsEmpty:h,goToAddFriends:m})}),(0,T.jsx)("div",{className:xe,ref:o,children:(0,T.jsxs)(Rs.w,{children:[(0,T.jsx)(Is.a,{title:r.Ru.get("buddy-feed.friend-activity"),panel:Es.Z.BuddyFeed,onClose:j,actions:(0,T.jsx)(c.Zp,{label:r.Ru.get("buddy-feed.add-friends"),children:(0,T.jsx)(l.a,{ariaLabel:r.Ru.get("buddy-feed.add-friends"),testId:"add-friends-button",size:"sm",onClick:x,icon:t.k})})}),(0,T.jsx)("div",{className:Re,children:(0,T.jsx)(l.a,{ariaLabel:r.Ru.get("buddy-feed.add-friends"),className:Ie,size:"sm",onClick:x,icon:t.k})}),h?(0,T.jsx)(Be,{}):(0,T.jsx)(fs,{friends:e,spec:d})]})})]})})})}}}]);
//# sourceMappingURL=xpui-routes-buddy-feed-legacy.js.map