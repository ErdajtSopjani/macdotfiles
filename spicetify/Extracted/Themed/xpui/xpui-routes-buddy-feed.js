"use strict";(("undefined"!=typeof self?self:global).webpackChunkclient_web=("undefined"!=typeof self?self:global).webpackChunkclient_web||[]).push([[7564],{2802:(e,s,a)=>{a.r(s),a.d(s,{default:()=>Ts});var i=a(30758),t=a(83169),n=a(89453),r=a(41331),l=a(61611),c=a(27046),d=a(69524),o=a(15231),u=a(74946),m=a(55204),f=a(78158),x=a(95404),h=a(69024);let j=function(e){return e[e.LOADING=0]="LOADING",e[e.CONNECTED=1]="CONNECTED",e[e.DISCONNECTED=2]="DISCONNECTED",e}({});var g=a(11892),b=a(25244),N=a(86595),p=a(2569);var y=a(97500),v=a.n(y),C=a(74554),k=a(5290),S=a(45292),R=a(14442),E=a(53452),w=a(57316);const L="jmX3vUTqdroySvWZjafY",I="sy4ejRXtpCCm2rnVCsBh",T="HO7uMcLeIpPBUBfBUF7f",O="EWRfCzpvY8DGEJrpWuib";var B=a(86070);const D=({name:e,following:s,imageUrl:a,uri:n})=>{const c=(0,E.f)(),d=(0,S.W)(),u=i.createRef(),[m,f]=(0,i.useState)(s);(0,w.N)(R.mc.OPERATION_COMPLETE,(e=>{if(e.data.uris.includes(n))switch(e.data.operation){case R.JK.FOLLOW_USER:f(!0);break;case R.JK.UNFOLLOW_USER:f(!1)}}));const x=(0,i.useCallback)((()=>{m?c.unfollowUsers([n]):(c.followUsers([n]),d({intent:"follow",type:"click",itemIdSuffix:"buddyfeed"})),u.current&&u.current.blur()}),[m,u,n,c,d]);return(0,i.useEffect)((()=>{f(s)}),[s]),(0,B.jsxs)("div",{className:L,children:[(0,B.jsx)(k.e,{label:e,width:40,userIconSize:"small",images:(0,i.useMemo)((()=>[{width:40,height:40,url:a}]),[a])}),(0,B.jsxs)("div",{className:v()(I,"ellipsis-one-line"),children:[(0,B.jsx)(o.E,{as:"p",variant:"bodySmallBold",className:"ellipsis-one-line",children:e}),m&&(0,B.jsx)(o.E,{as:"p",variant:"marginal",className:"ellipsis-one-line",children:r.Ru.get("following")})]}),(0,B.jsx)("div",{className:T,children:(0,B.jsx)(l.a,{className:O,size:"sm",ref:u,onClick:x,ariaLabel:m?r.Ru.get("buddy-feed.button.remove-friend"):r.Ru.get("buddy-feed.button.add-friend"),icon:m?C.M:t.k})})]})},P="rnrQ23E2_XN8d7ZBqsTp";function _({facebookFriends:e}){return(0,B.jsx)("div",{className:P,children:e.map((({uri:e,following:s,title:a,image:i})=>(0,B.jsx)(D,{uri:e,name:a,imageUrl:i,following:s},`fb-friend-${e}`)))})}const A="eGd6xxi5CmL4GBZoEnMi";function F(){return(0,B.jsx)("div",{className:A,children:Array(20).fill(0).map(((e,s)=>(0,B.jsx)(N.Y,{isLoading:!0,charCount:100,as:"p",variant:"titleSmall"},s)))})}const U="wFKGrAXEW5REryzTsDIb",Q="Na5e2ZRRgwg_8duvoFyo",z="sgUgGj3mSuAdpNv8AyYQ",M="ePqfotL3LdZXKKlsSp1G",Y="Jxd3auUMXwsqpPcizfbP",W="KPTOp08r5MTyYMmcTBcM",Z="uaVnv8WopjiEsa4Hpl_r",H="eI_jytcKj_NBe3vo5mvx",G="CxoJJA7kFeXzEeE2R6f7",J=({onBackButtonClick:e})=>{const[s,a]=(0,i.useState)(""),{isLoading:t,friends:n}=(e=>{const s=(0,h.C)(),a=e.trim().toLowerCase(),{data:i,isLoading:t}=(0,p.I)({queryKey:["useFacebookFriends"],queryFn:async()=>(await s.fetchFacebookFriends()).sort(((e,s)=>e.title>s.title?1:-1))});return{isLoading:t,friends:i?.filter((({title:e})=>-1!==e.trim().toLowerCase().indexOf(a)))??[]}})(s),c=(0,g.YQ)((e=>{a(e.target.value)}),100),u=(0,i.useCallback)((e=>{null!==e&&e.focus()}),[]);return(0,B.jsxs)("div",{className:U,children:[(0,B.jsx)(l.a,{ariaLabel:r.Ru.get("buddy-feed.button.back"),onClick:e,ref:u,className:Q,icon:d.g,size:"sm",testId:"back-to-friends"}),(0,B.jsxs)("div",{className:z,children:[(0,B.jsx)("div",{className:M,children:(0,B.jsx)(m.G,{className:Y,size:"large"})}),(0,B.jsx)("div",{className:W,children:t?(0,B.jsx)(N.Y,{isLoading:!0,charCount:25,as:"p",variant:"bodySmall"}):(0,B.jsx)(o.E,{as:"p",variant:"bodySmall",children:r.Ru.get("buddy-feed.number-of-friends",n.length)})})]}),t?(0,B.jsx)(F,{}):(0,B.jsxs)(B.Fragment,{children:[(0,B.jsxs)("div",{className:Z,children:[(0,B.jsx)(b.C,{className:G,size:"small",role:"presentation"}),(0,B.jsx)("input",{onChange:c,className:H,placeholder:r.Ru.get("buddy-feed.find-in-playlists")})]}),(0,B.jsx)(_,{facebookFriends:n})]})]})};var V=a(95926);function X({isOpen:e,onClose:s,onConfirm:a}){return(0,B.jsx)(V.T,{onClose:s,"aria-label":r.Ru.get("web-player.buddy-feed.connect-with-facebook-title"),onConfirm:a,titleText:r.Ru.get("web-player.buddy-feed.connect-with-facebook-title"),descriptionText:r.Ru.get("web-player.buddy-feed.connect-with-facebook-description"),cancelText:r.Ru.get("queue.cancel-button"),confirmText:r.Ru.get("web-player.buddy-feed.connect-button"),isOpen:e})}const q="PWrXmnQx41DSpIe1D_nH",K="AzWuuC6HtstaRZSyCs3n",$="VrSCtYccvuQZG9aY627D",ee="mSFjqxw0tzcwc0ZCN1YP",se="Q9ZfLJTBuMTFz4HsBThH",ae="_76MQUYO_OcYkQOL1dlw",ie="TOY_wX6BMTOxtaEcJX2X",te="A_pGgx3U5jNWUM85mJLQ",ne="ffXJrzSIg2CXoGlxDi0v",re="zmmtwzKSFa5srnl7Ftq2",le=e=>{const s=(0,S.W)(),{onBackButtonClick:a,feedIsEmpty:t,goToAddFriends:n=!1}=e,c=function(){const e=(0,h.C)(),[s,a]=(0,i.useState)(j.LOADING);return(0,i.useEffect)((()=>e.subscribeToFacebookConnectionState((e=>{a(e.connection?j.CONNECTED:j.DISCONNECTED)})).cancel),[e]),s}(),g=(0,h.C)(),[b,N]=(0,i.useState)(!1),[p,y]=(0,i.useState)(!1),[v,C]=(0,i.useState)(!1),k=(0,i.useCallback)((e=>{null!==e&&e.focus()}),[]),R=(0,i.useCallback)((()=>{location.reload()}),[]);if(p)return(0,B.jsxs)("div",{className:ne,children:[(0,B.jsx)(l.a,{onClick:a,ref:k,className:$,ariaLabel:r.Ru.get("buddy-feed.button.back"),icon:d.g,size:"sm"}),(0,B.jsxs)("div",{className:re,children:[(0,B.jsx)(o.E,{as:"h1",variant:"bodyMediumBold",className:K,children:r.Ru.get("error-dialog.generic.header")}),(0,B.jsx)(o.E,{as:"p",variant:"bodySmall",className:ee,children:r.Ru.get("error-dialog.generic.body")}),(0,B.jsx)(u.$,{colorSet:"invertedLight",onClick:R,children:r.Ru.get("error.reload")})]})]});const E=(n||v)&&c===j.CONNECTED;return(0,B.jsxs)("div",{className:q,children:[E&&(0,B.jsx)(J,{onBackButtonClick:()=>{t&&C(!1),a()}}),!E&&(0,B.jsxs)("div",{className:ae,children:[(0,B.jsx)(l.a,{ariaLabel:r.Ru.get("buddy-feed.button.back"),onClick:a,className:$,ref:k,icon:d.g,size:"sm"}),(0,B.jsx)(o.E,{as:"h1",variant:"bodyMediumBold",className:K,children:r.Ru.get("buddy-feed.friend-activity")}),(0,B.jsx)(o.E,{as:"p",variant:"bodySmall",className:ee,children:r.Ru.get("buddy-feed.facebook.connect-with-friends-default")}),(0,B.jsx)("div",{className:ie,children:(0,B.jsx)(u.$,{className:te,size:"small",iconLeading:m.G,UNSAFE_colorSet:(0,f.mA)("#2374E1",x.ONy),onClick:()=>{s({intent:"connect-to-facebook",type:"click",itemIdSuffix:"buddyfeed"}),c!==j.CONNECTED?N(!0):C(!0)},children:r.Ru.get("buddy-feed.facebook.button")})}),(0,B.jsx)(o.E,{as:"p",variant:"marginal",className:se,children:r.Ru.get("buddy-feed.facebook.disclaimer")}),(0,B.jsx)(X,{isOpen:b,onClose:()=>{N(!1)},onConfirm:()=>{g.connectToFacebook().then((()=>{C(!0),N(!1)})).catch((()=>{y(!0)}))}})]})]})};var ce=a(58923),de=a(75977);const oe="jGcEaPyhr1c_janM2uRF",ue="OemaZktMXaRcYQ5bcfLZ",me="o5IJsOJEWBEyxtPVVVqQ",fe="yHlSWaHkqZHm5mcY8ZFh",xe="toPt7VOT_PiDx5Gj3SM2",he="xU4sacBisQneHoQeHMP5",je="srjSlmxMGzXnJBc32BJa",ge="lju7xv10a5Y5Z8h8CcKJ",be="jr794VV4i2iUBRhfvS5i",Ne="KE3gK5ccLz2gL3dhJ4BW",pe="pO2rsGFqUdaNhpLrif21",ye="Ydxgl4Y23orfVVVI9O2k",ve="VhqWrkzIrJrvdyj7ZXMd",Ce="T3liC_3fbMOTilR4HHKD",ke="W_tr6AMQB9Chbc9bCS9w",Se="yDdNxgieZmqjgHQCW3UE",Re="iRrzzadYGo2MSuVhmVCn",Ee="_8yOZhEqs2xrYtslnNcDw",we="aikUDGtqRnCX0ZwYHDUW",Le="T_HXMW6n5qsbLbPTr1GS",Ie="tYswKV9PmtTCv62LOPIV",Te="GlDNRQ2w0t4h9WBI4GgN",Oe="BQGSV5BvuAaJ5rmFAXLp",Be="ZLbFjRdp1AMXebZH6UWM",De="jhtyHt6d9vbxK6VtCI7a",Pe="oCaGCB13zdReRutfBS8_",_e="MR1n58Qu0kPorQtveOCQ",Ae="y10vXronmQ6eYMlJrIp3",Fe=({showOnlineIndicator:e})=>(0,B.jsxs)("div",{className:Ie,children:[(0,B.jsxs)("div",{className:Te,children:[(0,B.jsx)(de.v,{size:"medium"}),e?(0,B.jsx)("div",{className:Oe}):null]}),(0,B.jsxs)("div",{className:Be,children:[(0,B.jsx)("div",{className:v()(De,Pe)}),(0,B.jsx)("div",{className:De}),(0,B.jsx)("div",{className:De})]})]}),Ue=()=>(0,B.jsxs)("div",{"data-testid":"buddy-feed-empty-state",className:we,children:[(0,B.jsx)(o.E,{as:"p",className:Le,children:r.Ru.get("buddy-feed.let-followers-see-your-listening")}),(0,B.jsx)(Fe,{showOnlineIndicator:!0}),(0,B.jsx)(Fe,{showOnlineIndicator:!0}),(0,B.jsx)(Fe,{}),(0,B.jsx)(o.E,{as:"p",className:Le,children:r.Ru.get("buddy-feed.enable-share-listening-activity")}),(0,B.jsx)(ce.N_,{to:"/preferences",className:_e,children:(0,B.jsx)(u.$,{colorSet:"invertedLight",className:Ae,children:r.Ru.get("desktop.settings.settings")})})]});var Qe=a(68832),ze=a(59677),Me=a(93720),Ye=a(99870),We=a(75668),Ze=a(21813),He=a(33e3),Ge=a(36450),Je=a(23100),Ve=a(91360),Xe=a(70462),qe=a(35494),Ke=a(67611);const $e=e=>{const{timestamp:s,isNowPlaying:a}=e;return a?(0,B.jsx)(c.Zp,{label:r.Ru.get("time.now"),children:(0,B.jsx)(qe.A,{"aria-label":r.Ru.get("time.now"),size:"small"})}):(0,B.jsx)("span",{children:(0,Ke.Z)(s)})};var es=a(68031),ss=a(53222),as=a(78330),is=a(98882),ts=a(4139),ns=a(86317);const rs=e=>Date.now()-e<9e5,ls=(e,s)=>{const a=(0,ze.o_)(e)?.type;switch(a){case ze.NQ.PLAYLIST:case ze.NQ.PLAYLIST_V2:return(0,B.jsx)(Ze.W,{uri:e});case ze.NQ.EPISODE:case ze.NQ.SHOW:return(0,B.jsx)(He.H,{uri:e});case ze.NQ.ALBUM:return(0,B.jsx)(Ye.h,{uri:e,artistUri:s});case ze.NQ.ARTIST:return(0,B.jsx)(We.t,{uri:e});default:return null}},cs=e=>{switch(e){case ze.NQ.ALBUM:return ns.c.ALBUM;case ze.NQ.ARTIST:return ns.c.ARTIST;case ze.NQ.SHOW:return ns.c.SHOW;case ze.NQ.EPISODE:return ns.c.EPISODE;case ze.NQ.PLAYLIST:case ze.NQ.PLAYLIST_V2:return ns.c.PLAYLIST;default:return}},ds=e=>{const{show:s=!0,spec:a,friend:t}=e,n=(0,i.useMemo)((()=>t.user.imageUrl?[{url:t.user.imageUrl,width:0,height:0}]:[]),[t.user.imageUrl]),l=(0,S.W)(),c=(0,ts.s)(),d=t.track,u=d.uri,{togglePlay:m,isPlaying:f,isActive:x}=(0,is.P)({uri:u},{featureIdentifier:"buddy_feed",referrerIdentifier:"buddy_feed"}),h=(0,ze.o_)(d.context?.uri),j=h?.type,g=(0,i.useCallback)((()=>{m(),l({intent:f?"pause":"play",type:"click",itemIdSuffix:"buddyfeed_play",targetUri:u});const e=a.friendRowFactory().playButtonFactory();x?f?c.logInteraction(e.hitPause({itemToBePaused:u})):c.logInteraction(e.hitResume({itemToBeResumed:u})):c.logInteraction(e.hitPlay({itemToBePlayed:u}))}),[l,f,u,a,x,m,c]),b=(0,i.useCallback)(((e,s)=>{c.logInteraction(a.friendRowFactory().friendRowLinkFactory({identifier:e}).hitUiNavigate({destination:s}))}),[c,a]),{draggable:N,onDragStart:p}=(0,es.P)({itemUris:[u],dragLabelText:d.name}),{draggable:y,onDragStart:C}=(0,es.P)({itemUris:[d.artist?.uri],dragLabelText:d.artist?.name}),{draggable:R,onDragStart:E}=(0,es.P)({itemUris:[d.context?.uri],dragLabelText:d.context?.name});return s?(0,B.jsxs)("div",{className:v()(oe),children:[(0,B.jsx)(Me.h,{menu:ls(d.context?.uri,d.artist?.uri),children:(0,B.jsxs)("div",{className:he,children:[(0,B.jsx)(k.e,{label:t.user.name,width:40,userIconSize:"small",images:n,withBadge:rs(t.timestamp)}),(0,B.jsx)(Xe.x,{className:je,iconClassName:ge,isPlaying:f,isLocked:!1,onClick:g,playAriaLabel:f?r.Ru.get("pause"):`${r.Ru.get("play")} ${d.artist.name} ${d.name}`})]})}),(0,B.jsxs)("div",{className:v()(be),children:[(0,B.jsxs)("div",{className:Ne,children:[(0,B.jsx)(o.E,{as:"p",variant:"bodySmallBold",className:v()(pe,"ellipsis-one-line"),children:(0,B.jsx)(as.pZ,{value:"/buddyfeed_user_profile",children:(0,B.jsx)(Me.h,{menu:(0,B.jsx)(Je.B,{uri:t.user.uri}),children:(0,B.jsx)(Ve.N,{title:t.user.name,to:t.user.uri,dir:"auto",onClick:()=>b("profile_link",t.user.uri),children:t.user.name})})})}),(0,B.jsx)(o.E,{as:"p",variant:"marginal",className:v()(ye),children:(0,B.jsx)($e,{timestamp:t.timestamp,isNowPlaying:rs(t.timestamp)})})]}),(0,B.jsxs)(o.E,{as:"p",variant:"marginal",className:ve,children:[(0,B.jsx)(as.pZ,{value:"/buddyfeed_track",children:(0,B.jsx)(Me.h,{menu:(0,B.jsx)(Ge.P,{uri:d.uri,contextUri:d.context?.uri,albumUri:d.album?.uri,artists:[d.artist]}),children:(0,B.jsx)(Ve.N,{title:d.name,to:u,className:"ellipsis-one-line",dir:"auto",draggable:N,onDragStart:p,onClick:()=>b("track_link",u),children:d.name})})}),(0,B.jsx)("span",{"aria-hidden":!0,children:" • "}),(0,B.jsx)(as.pZ,{value:"/buddyfeed_artist",children:(0,B.jsx)(Me.h,{menu:d.artist?(0,B.jsx)(We.t,{uri:d.artist.uri}):null,children:(0,B.jsx)(Ve.N,{title:d.artist?.name,to:d.artist?.uri,className:"ellipsis-one-line",dir:"auto",draggable:y,onDragStart:C,onClick:()=>b("artist_link",d.artist?.uri),children:d.artist?.name})})})]}),(0,B.jsx)(o.E,{as:"p",variant:"marginal",className:v()("ellipsis-one-line",ke),children:(0,B.jsx)(as.pZ,{value:"/buddyfeed_context",children:(0,B.jsx)(Me.h,{menu:ls(d.context?.uri,d.artist?.uri),children:(0,B.jsxs)(Ve.N,{title:d.context?.name,to:d.context?.uri,className:Se,draggable:R,onDragStart:E,onClick:()=>b("context_link",d.context?.uri),children:[(0,B.jsx)(ss.s,{type:cs(j),iconSize:16,className:Ce}),(0,B.jsx)("span",{dir:"auto",className:"ellipsis-one-line",children:d.context?.name})]})})})})]})]},t.user.uri):null};var os=a(81083),us=a(23330),ms=a(80451);function fs({friends:e,spec:s}){const{currentSession:a}=(0,ms.D)(),t=(0,us.y)(),[n,r]=(0,i.useState)(!0),l=!a?.active&&t&&n&&(0,B.jsx)("li",{className:me,children:(0,B.jsx)(os.p,{localStorageKey:"dismissStartJamButtonFromFriendFeed",onDismiss:()=>r(!1)})},"start-jam-button");return(0,B.jsx)(Qe.ZI,{flipKey:e.map((e=>e.user.uri)).join(""),children:(0,B.jsxs)("ul",{className:ue,children:[l,e.map(((e,a)=>(0,B.jsx)(Qe.lf,{flipId:e.user.uri,children:(0,B.jsx)("li",{children:(0,B.jsx)(ds,{friend:e,show:a<100,spec:s},e.user.uri)})},e.user.uri)))]})})}var xs=a(95079),hs=a(94079);const js="VTOHA2pQ5UOAQhut6swb",gs="y02ezh9Bcfm_61XcxvOS",bs="rb6j61g6Avhg8RARvz3b",Ns="xDW2awz1Oc3Khs6Wsn8g",ps="MOKoNTiYkc9jh0xhfoZH",ys="gOHEpGu2st4QQtJy8OPw",vs="ijngDXlnRFRYySzwV5JJ",Cs="oNiqjPtyJeYH6LqZlnVa",ks=({children:e,page:s,nodeRef:a})=>{const i=0===s,t=e.filter(((e,a)=>a!==s));return(0,B.jsx)(xs.A,{component:null,children:t.map((e=>(0,B.jsx)(hs.A,{in:i,timeout:500,nodeRef:a,classNames:{enter:i?js:ps,enterActive:i?gs:ys,exit:i?bs:vs,exitActive:i?Ns:Cs},children:e},i?"first-page":"second-page")))})};var Ss=a(75808),Rs=a(70249),Es=a(58111),ws=a(22594),Ls=a(70329),Is=a(78487);const Ts=({friends:e})=>{const s=(0,S.W)(),a=(0,ts.s)(),{spec:d}=(0,Is.r)(n.W,{}),o=(0,i.useRef)(null),u=(0,i.useRef)(null);(0,i.useEffect)((()=>{s({intent:"view",type:"impression",itemIdSuffix:"buddyfeed"})}),[s]),(0,i.useEffect)((()=>{a.logImpression(d.impression())}),[a,d]);const[m,f]=(0,i.useState)(!1),x=()=>{m||a.logInteraction(d.addFriendButtonFactory().hitUiReveal()),f(!m)},h=0===e.length,j=(0,i.useCallback)((()=>{a.logInteraction(d.closeButtonFactory().hitUiHide())}),[a,d]);return(0,B.jsx)(Ls.ql.Provider,{value:"buddy_feed",children:(0,B.jsx)(Ss._,{label:r.Ru.get("buddy-feed.friend-activity"),focusTransferId:"BUDDY-FEED",children:(0,B.jsxs)(ks,{page:m?1:0,nodeRef:m?u:o,children:[(0,B.jsx)("div",{className:fe,ref:u,children:(0,B.jsx)(le,{onBackButtonClick:x,feedIsEmpty:h,goToAddFriends:m})}),(0,B.jsx)("div",{className:xe,ref:o,children:(0,B.jsxs)(Rs.w,{children:[(0,B.jsx)(Es.a,{title:r.Ru.get("buddy-feed.friend-activity"),panel:ws.Z.BuddyFeed,onClose:j,actions:(0,B.jsx)(c.Zp,{label:r.Ru.get("buddy-feed.add-friends"),children:(0,B.jsx)(l.a,{ariaLabel:r.Ru.get("buddy-feed.add-friends"),testId:"add-friends-button",size:"sm",onClick:x,icon:t.k})})}),(0,B.jsx)("div",{className:Re,children:(0,B.jsx)(l.a,{ariaLabel:r.Ru.get("buddy-feed.add-friends"),className:Ee,size:"sm",onClick:x,icon:t.k})}),h?(0,B.jsx)(Ue,{}):(0,B.jsx)(fs,{friends:e,spec:d})]})})]})})})}}}]);
//# sourceMappingURL=xpui-routes-buddy-feed.js.map