"use strict";(("undefined"!=typeof self?self:global).webpackChunkclient_web=("undefined"!=typeof self?self:global).webpackChunkclient_web||[]).push([[5523],{58903:(e,t,r)=>{r.r(t),r.d(t,{default:()=>H});var a=r(77),n=r(40904),o=r(39733),s=r(41331),i=r(21560),c=r(7029),l=r(36809);var u=r(30758),d=r(41978),g=r(44043),h=r(69550);const I=(0,r(15348).h)(),p="sp://auth/v1/token_web_auth";async function f(e){if(!e)return;const t=new URL(p);return t.searchParams.append("audience",e),await I.get(t.toString())}const N="NWSmcn03uY8Fosh_mYCi",E="N9ngMcd9oSDEd8zK5jBj",T="kYOJhuJ996EIMXFJD3By";var y=r(86070);const b=e=>{const{url:t,clientId:r}=e,a=function(e){const t=(0,d.wA)(),[r,a]=(0,u.useState)(""),n=(0,u.useCallback)((async()=>{if(e){t((0,g.w9)());const r=await f(e).catch((e=>{throw(0,h.t)().error("error: could not fetch IDT token!"),t((0,g.wm)(e)),e}));r&&(t((0,g.sB)(r.accessToken)),a(r.accessToken))}}),[e,t]);return(0,u.useEffect)((()=>{e&&n()}),[e,n]),r}(r),n=(()=>{const e=(0,l.k)();if(!e)return;const{containerVersion:t}=e;return t.substring(0,t.lastIndexOf("."))})();let o="";return t&&n&&(o=function(e,t,r){const a=new URL(e);a.searchParams.append("utm_app_version",t),r&&(a.hash=`#id_token=${r}`);return a.toString()}(t,n,a)),(0,y.jsx)("div",{className:N,children:(0,y.jsx)("iframe",{title:s.Ru.get("web-player.the-stage.title"),name:"stage-view-frame",id:E,src:o,sandbox:"allow-scripts allow-same-origin"})})};var k=r(97500),C=r.n(k),S=r(70329);var O=r(17504),D=r(20078),L=r(22594);const w=D.$S.PANEL_CLOSE_CLICK;var v=r(59677),A=r(52891);var R=r(93484);function m(e,t){const r=(0,u.useRef)(),n=(0,u.useMemo)((()=>new AbortController),[]),{signal:o}=n,i=function(){const e=(0,a.Zp)(),t=(0,d.d4)((e=>e.ui.history.canGoBack));return(0,u.useCallback)((()=>{e(t?-1:"/")}),[e,t])}(),c=(()=>{const e=(0,d.wA)(),{enqueueSnackbar:t}=(0,A.d)();return{onSuccess:()=>{t(s.Ru.get("feedback.link-copied")),e((0,g.ue)())},onError:r=>{t(s.Ru.get("error.generic")),e((0,g.sb)(r))}}})(),l=(0,u.useCallback)((a=>{if(!e||!e.includes(a.origin))return;const n=JSON.parse(a.data);"didRequestInitialize"===n.type?(r.current={source:a.source,options:{targetOrigin:a.origin}},function(e){const{source:t,options:r}=e,a=JSON.stringify({type:"ready",capabilities:{}});t.postMessage(a,r)}(r.current)):"didRequestIDToken"===n.type?(r.current={source:a.source,options:{targetOrigin:a.origin}},async function(e,t){const{source:r,options:a}=e,n=await f(t);if(!n)return;if(!n.accessToken)return;const o=JSON.stringify({type:"didReceiveIDToken",token:n.accessToken});r.postMessage(o,a)}(r.current,t)):"didRequestClose"===n.type?i():"didRequestShare"===n.type&&async function(e,t,r){const{source:a,options:n}=e;if("didRequestShare"!==t.type)return;let o;const s=(0,v.o_)(t.url);s&&(o=s.toURL());await(0,R.l)(o).catch((e=>{throw r.onError(e),e})),r.onSuccess();const i={type:"didDismissShare",requestId:t.requestId};a.postMessage(JSON.stringify(i),n)}(r.current,n,c)}),[e,t,c,i]);(0,u.useEffect)((()=>(e&&window.addEventListener("message",(e=>l(e)),{signal:o}),()=>{n.abort()})),[e,n,l,o])}var P=r(69180);var B=r(2569);let G=function(e){return e[e.NONE=0]="NONE",e[e.STT=1]="STT",e[e.IDT=2]="IDT",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED",e}({});function V(e){switch(e){case 0:case"NONE":return G.NONE;case 1:case"STT":return G.STT;case 2:case"IDT":return G.IDT;default:return G.UNRECOGNIZED}}let M=function(e){return e[e.INVALID=0]="INVALID",e[e.VALID=1]="VALID",e[e.ACTIVE=2]="ACTIVE",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED",e}({});function U(e){switch(e){case 0:case"INVALID":return M.INVALID;case 1:case"VALID":return M.VALID;case 2:case"ACTIVE":return M.ACTIVE;default:return M.UNRECOGNIZED}}let K=function(e){return e[e.ALCOHOL=0]="ALCOHOL",e[e.ENERGY_DRINKS=1]="ENERGY_DRINKS",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED",e}({});const _={fromJSON:e=>({id:Z(e.id)?globalThis.String(e.id):"0",campaignId:Z(e.campaignId)?globalThis.String(e.campaignId):"0",lookupToken:Z(e.lookupToken)?globalThis.String(e.lookupToken):"",url:Z(e.url)?globalThis.String(e.url):"",authType:Z(e.authType)?V(e.authType):0,clientId:Z(e.clientId)?globalThis.String(e.clientId):void 0,hasAudio:!!Z(e.hasAudio)&&globalThis.Boolean(e.hasAudio),status:Z(e.status)?U(e.status):0,restricted:!!Z(e.restricted)&&globalThis.Boolean(e.restricted),gcpProjectId:Z(e.gcpProjectId)?globalThis.String(e.gcpProjectId):"",defaultLocale:Z(e.defaultLocale)?globalThis.String(e.defaultLocale):"",restrictions:globalThis.Array.isArray(e?.restrictions)?e.restrictions.map((e=>function(e){switch(e){case 0:case"ALCOHOL":return K.ALCOHOL;case 1:case"ENERGY_DRINKS":return K.ENERGY_DRINKS;default:return K.UNRECOGNIZED}}(e))):[],enableLegacySharing:!!Z(e.enableLegacySharing)&&globalThis.Boolean(e.enableLegacySharing),hidePlayer:!!Z(e.hidePlayer)&&globalThis.Boolean(e.hidePlayer),legacyBackBehavior:!!Z(e.legacyBackBehavior)&&globalThis.Boolean(e.legacyBackBehavior),enableCheckout:!!Z(e.enableCheckout)&&globalThis.Boolean(e.enableCheckout),allowedCountries:globalThis.Array.isArray(e?.allowedCountries)?e.allowedCountries.map((e=>globalThis.String(e))):[],restoreOnKilled:!!Z(e.restoreOnKilled)&&globalThis.Boolean(e.restoreOnKilled),enableMediaDevices:!!Z(e.enableMediaDevices)&&globalThis.Boolean(e.enableMediaDevices)}),toJSON(e){const t={};return"0"!==e.id&&(t.id=e.id),"0"!==e.campaignId&&(t.campaignId=e.campaignId),""!==e.lookupToken&&(t.lookupToken=e.lookupToken),""!==e.url&&(t.url=e.url),0!==e.authType&&(t.authType=function(e){switch(e){case G.NONE:return"NONE";case G.STT:return"STT";case G.IDT:return"IDT";case G.UNRECOGNIZED:default:return"UNRECOGNIZED"}}(e.authType)),void 0!==e.clientId&&(t.clientId=e.clientId),!1!==e.hasAudio&&(t.hasAudio=e.hasAudio),0!==e.status&&(t.status=function(e){switch(e){case M.INVALID:return"INVALID";case M.VALID:return"VALID";case M.ACTIVE:return"ACTIVE";case M.UNRECOGNIZED:default:return"UNRECOGNIZED"}}(e.status)),!1!==e.restricted&&(t.restricted=e.restricted),""!==e.gcpProjectId&&(t.gcpProjectId=e.gcpProjectId),""!==e.defaultLocale&&(t.defaultLocale=e.defaultLocale),e.restrictions?.length&&(t.restrictions=e.restrictions.map((e=>function(e){switch(e){case K.ALCOHOL:return"ALCOHOL";case K.ENERGY_DRINKS:return"ENERGY_DRINKS";case K.UNRECOGNIZED:default:return"UNRECOGNIZED"}}(e)))),!1!==e.enableLegacySharing&&(t.enableLegacySharing=e.enableLegacySharing),!1!==e.hidePlayer&&(t.hidePlayer=e.hidePlayer),!1!==e.legacyBackBehavior&&(t.legacyBackBehavior=e.legacyBackBehavior),!1!==e.enableCheckout&&(t.enableCheckout=e.enableCheckout),e.allowedCountries?.length&&(t.allowedCountries=e.allowedCountries),!1!==e.restoreOnKilled&&(t.restoreOnKilled=e.restoreOnKilled),!1!==e.enableMediaDevices&&(t.enableMediaDevices=e.enableMediaDevices),t},create:e=>_.fromPartial(e??{}),fromPartial(e){const t={id:"0",campaignId:"0",lookupToken:"",url:"",authType:0,clientId:void 0,hasAudio:!1,status:0,restricted:!1,gcpProjectId:"",defaultLocale:"",restrictions:[],enableLegacySharing:!1,hidePlayer:!1,legacyBackBehavior:!1,enableCheckout:!1,allowedCountries:[],restoreOnKilled:!1,enableMediaDevices:!1};return t.id=e.id??"0",t.campaignId=e.campaignId??"0",t.lookupToken=e.lookupToken??"",t.url=e.url??"",t.authType=e.authType??0,t.clientId=e.clientId??void 0,t.hasAudio=e.hasAudio??!1,t.status=e.status??0,t.restricted=e.restricted??!1,t.gcpProjectId=e.gcpProjectId??"",t.defaultLocale=e.defaultLocale??"",t.restrictions=e.restrictions?.map((e=>e))||[],t.enableLegacySharing=e.enableLegacySharing??!1,t.hidePlayer=e.hidePlayer??!1,t.legacyBackBehavior=e.legacyBackBehavior??!1,t.enableCheckout=e.enableCheckout??!1,t.allowedCountries=e.allowedCountries?.map((e=>e))||[],t.restoreOnKilled=e.restoreOnKilled??!1,t.enableMediaDevices=e.enableMediaDevices??!1,t}};const j={fromJSON:e=>({site:Z(e.site)?_.fromJSON(e.site):void 0}),toJSON(e){const t={};return void 0!==e.site&&(t.site=_.toJSON(e.site)),t},create:e=>j.fromPartial(e??{}),fromPartial(e){const t={site:void 0};return t.site=void 0!==e.site&&null!==e.site?_.fromPartial(e.site):void 0,t}};function Z(e){return null!=e}var J=r(76629);var q=r(93409);const x=e=>{const t=[e],{onStart:r,onSuccess:a,onError:n}=(()=>{const e=(0,d.wA)();return{onStart:()=>e((0,g.p)()),onSuccess:()=>e((0,g.n7)()),onError:t=>e((0,g.LR)(t))}})(),{data:o,error:s,isLoading:i,isError:c}=(0,B.I)({queryKey:t,queryFn:async()=>await(async(e,t)=>await e.build().withHost(`${J.sp}`).withMethod("GET").withoutMarket().withPath(`/site/${t}`).withEndpointIdentifier("/site/{lookupId}").withJsonContentType().send().then((e=>({...e,body:j.fromJSON(e.body)}))))(q.n.getInstance(),e),staleTime:6e5,gcTime:18e5});return i?r():c?n(s):a(),{data:o?.body.site,loading:i,isError:c}};var Y=r(19019);const H=e=>{(()=>{const{scrollNodeChildRef:e}=(0,u.useContext)(S.bi);(0,u.useEffect)((()=>{const t=e?.current,r=e?.current?.className;return t&&(t.className=C()(r,T)),()=>{t&&(t.className=C()(r))}}),[e])})(),(()=>{const{isActive:e,panelSend:t}=(0,O.AI)(L.Z.NowPlayingView);e&&t(w)})(),function(){const e=(0,P.z)();e.getState()?.hasContext&&!e.getState()?.isPaused&&e.pause()}();const{lookupToken:t=""}=(0,a.g)(),{loading:r,data:l,isError:h}=x(t);((e,t)=>{const r=(0,d.wA)();(0,u.useEffect)((()=>(r((0,g.Jo)({siteId:e,sessionId:t,startTime:Date.now()})),()=>{r((0,g.et)())})),[r,e,t])})(t,(0,n.A)()),m(l?.url,l?.clientId);return(0,o.NC)(Y.n2U)?(0,y.jsx)(i.s,{children:r?(0,y.jsx)(c.LoadingPage,{hasError:h,errorMessage:s.Ru.get("error.generic")}):(0,y.jsx)(b,{url:l?.url,clientId:l?.clientId})}):(0,y.jsx)(c.LoadingPage,{hasError:h,errorMessage:s.Ru.get("error.not_found.title.page")})}},36809:(e,t,r)=>{r.d(t,{k:()=>o});var a=r(30758),n=r(94010);function o(){const e=(0,n.t)(),[t,r]=(0,a.useState)(null);return(0,a.useEffect)((()=>{let t=!0;return e.getVersionInfo().then((e=>{t&&r(e)})),()=>{t=!1}}),[e,r]),t}}}]);
//# sourceMappingURL=xpui-routes-stage-page.js.map